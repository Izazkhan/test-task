<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPA - Categories & Courses</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- i want this to center - sidebar size 300px -->
    <div class="page-title">
        <h2 style="margin: auto">Course Catalog</h2>
    </div>
    <div class="container">
        <div class="sidebar">
            <h3>Categories</h3>
            <div id="categories">
                <ul id="myUL">
                </ul>
            </div>
        </div>
        <div id="content">
            <div id="courses">
                <div class="course">
                    <img src="https://cdn0.knowledgecity.com/opencontent/courses/previews/L373312762/800--v112243.jpg"
                        alt="Finance and Accounting Basics for Nonfinancial Executives">
                    <div class="cnt">
                        <h4>Finance and Accounting Basics for Nonfinancial Executives</h4>
                        <div class="description">Financial knowledge is vital to an executiveâ€™s role in a business,
                            but
                            the systems within a
                            business can be extremely complex. Without a strong foundation of financial analytics, it
                            can be
                            difficult to interpret, report, or even understand a businessâ€™s financial standing. A lack
                            of
                            understanding can impede your ability to make educated decisions. By understanding where the
                            data comes from and how accounting operates, you can manage your business with greater
                            efficiency and interpret business systems more accurately.</div>
                    </div>
                </div>
                <div class="course">
                    <img src="https://cdn0.knowledgecity.com/opencontent/courses/previews/L373312762/800--v112243.jpg"
                        alt="Finance and Accounting Basics for Nonfinancial Executives">
                    <di class="cnt">
                        <h4>Finance and Accounting Basics for Nonfinancial Executives</h4>
                        <div class="description">Financial knowledge is vital to an executiveâ€™s role in a business,
                            but
                            the systems within a
                            business can be extremely complex. Without a strong foundation of financial analytics, it
                            can be
                            difficult to interpret, report, or even understand a businessâ€™s financial standing. A lack
                            of
                            understanding can impede your ability to make educated decisions. By understanding where the
                            data comes from and how accounting operates, you can manage your business with greater
                            efficiency and interpret business systems more accurately.</div>
                    </di>
                </div>
                <div class="course">
                    <img src="https://cdn0.knowledgecity.com/opencontent/courses/previews/L373312762/800--v112243.jpg"
                        alt="Finance and Accounting Basics for Nonfinancial Executives">
                    <div class="cnt">
                        <h4>Finance and Accounting Basics for Nonfinancial Executives</h4>
                        <div class="description">Financial knowledge is vital to an executiveâ€™s role in a business,
                            but
                            the systems within a
                            business can be extremely complex. Without a strong foundation of financial analytics, it
                            can be
                            difficult to interpret, report, or even understand a businessâ€™s financial standing. A lack
                            of
                            understanding can impede your ability to make educated decisions. By understanding where the
                            data comes from and how accounting operates, you can manage your business with greater
                            efficiency and interpret business systems more accurately.</div>
                    </div>
                </div>
                <div class="course">
                    <img src="https://cdn0.knowledgecity.com/opencontent/courses/previews/L373312762/800--v112243.jpg"
                        alt="Finance and Accounting Basics for Nonfinancial Executives">
                    <div class="cnt">
                        <h4>Finance and Accounting Basics for Nonfinancial Executives</h4>
                        <div class="description">Financial knowledge is vital to an executiveâ€™s role in a business,
                            but
                            the systems within a
                            business can be extremely complex. Without a strong foundation of financial analytics, it
                            can be
                            difficult to interpret, report, or even understand a businessâ€™s financial standing. A lack
                            of
                            understanding can impede your ability to make educated decisions. By understanding where the
                            data comes from and how accounting operates, you can manage your business with greater
                            efficiency and interpret business systems more accurately.</div>
                    </div>
                </div>
                <div class="course">
                    <img src="https://cdn0.knowledgecity.com/opencontent/courses/previews/L373312762/800--v112243.jpg"
                        alt="Finance and Accounting Basics for Nonfinancial Executives">
                    <div class="cnt">
                        <h4>Finance and Accounting Basics for Nonfinancial Executives</h4>
                        <div class="description">Financial knowledge is vital to an executiveâ€™s role in a business,
                            but
                            the systems within a
                            business can be extremely complex. Without a strong foundation of financial analytics, it
                            can be
                            difficult to interpret, report, or even understand a businessâ€™s financial standing. A lack
                            of
                            understanding can impede your ability to make educated decisions. By understanding where the
                            data comes from and how accounting operates, you can manage your business with greater
                            efficiency and interpret business systems more accurately.</div>
                    </div>
                </div>
                <div class="course">
                    <img src="https://cdn0.knowledgecity.com/opencontent/courses/previews/L373312762/800--v112243.jpg"
                        alt="Finance and Accounting Basics for Nonfinancial Executives">
                    <div class="cnt">
                        <h4>Finance and Accounting Basics for Nonfinancial Executives</h4>
                        <div class="description">Financial knowledge is vital to an executiveâ€™s role in a business,
                            but
                            the systems within a
                            business can be extremely complex. Without a strong foundation of financial analytics, it
                            can be
                            difficult to interpret, report, or even understand a businessâ€™s financial standing. A lack
                            of
                            understanding can impede your ability to make educated decisions. By understanding where the
                            data comes from and how accounting operates, you can manage your business with greater
                            efficiency and interpret business systems more accurately.</div>
                    </div>
                </div>
                <div class="course">
                    <img src="https://cdn0.knowledgecity.com/opencontent/courses/previews/L373312762/800--v112243.jpg"
                        alt="Finance and Accounting Basics for Nonfinancial Executives">
                    <div class="cnt">
                        <h4>Finance and Accounting Basics for Nonfinancial Executives</h4>
                        <div class="description">Financial knowledge is vital to an executiveâ€™s role in a business,
                            but
                            the systems within a
                            business can be extremely complex. Without a strong foundation of financial analytics, it
                            can be
                            difficult to interpret, report, or even understand a businessâ€™s financial standing. A lack
                            of
                            understanding can impede your ability to make educated decisions. By understanding where the
                            data comes from and how accounting operates, you can manage your business with greater
                            efficiency and interpret business systems more accurately.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            var toggler = document.getElementsByClassName("carett");
            var i;

            for (i = 0; i < toggler.length; i++) {
                toggler[i].addEventListener("click", function () {
                    this.parentElement.querySelector(".nested").classList.toggle("active");
                });
            }
            async function fetchCategories() {
                try {
                    let response = await fetch('http://api.cc.localhost/categories');
                    let categories = await response.json();
                    renderCategories(categories);
                } catch (error) {
                    console.error('Error fetching categories:', error);
                }
            }

            // function renderCategories(categories, parentId = null, container = document.getElementById('myUL')) {
            //     let filteredCategories = categories.filter(cat => cat.parent_id === parentId);

            //     filteredCategories.forEach(category => {
            //         let li = document.createElement('li');

            //         let span = document.createElement('span');
            //         span.classList.add('caret');
            //         span.textContent = category.category_name + `(${category.count_of_courses})`;
            //         span.onclick = () => fetchCourses(category.category_id);

            //         li.appendChild(span);

            //         let subList = document.createElement('ul');
            //         subList.classList.add('nested');
            //         li.appendChild(subList);

            //         container.appendChild(li);
            //         renderCategories(categories, category.category_id, subList);
            //     });
            // }

            function renderCategories(categories, parentId = null, container = document.getElementById('myUL')) {
                let filteredCategories = categories.filter(cat => cat.parent_id === parentId);

                filteredCategories.forEach(category => {
                    let li = document.createElement('li');
                    li.setAttribute("data-key", category.category_id);
                    let span = document.createElement('span');
                    span.classList.add('caret');
                    span.textContent = `${category.category_name} (${category.count_of_courses})`;

                    let hasCourses = category.count_of_courses > 0;
                    let childHasCourses = categories.some(cat => cat.parent_id === category.category_id && cat.count_of_courses > 0);

                    if (hasCourses || childHasCourses) {
                        span.style.cursor = 'pointer'; // Show hand cursor for clickable items
                        span.onclick = () => fetchCoursesRecursive(category.category_id, categories);
                    }

                    li.appendChild(span);
                    let subList = document.createElement('ul');
                    subList.classList.add('nested');
                    li.appendChild(subList);

                    container.appendChild(li);
                    renderCategories(categories, category.category_id, subList);
                });
            }

            function fetchCoursesRecursive(categoryId, categories) {
                let categoryIdsToFetch = [categoryId]; // Always include the clicked category

                function findChildrenWithCourses(parentId) {
                    categories.forEach(cat => {
                        if (cat.parent_id === parentId) {
                            if (cat.count_of_courses > 0 || hasChildrenWithCourses(cat.category_id, categories)) {
                                categoryIdsToFetch.push(cat.category_id);
                            }
                            findChildrenWithCourses(cat.category_id);
                        }
                    });
                }

                function hasChildrenWithCourses(parentId, categories) {
                    return categories.some(cat => cat.parent_id === parentId && cat.count_of_courses > 0);
                }

                findChildrenWithCourses(categoryId);

                // Fetch courses for all collected category IDs
                categoryIdsToFetch.forEach(id => fetchCourses(id));
            }



            function toggleCategory(element, categoryId) {
                element.classList.toggle('open');
                fetchCourses(categoryId);
            }

            async function fetchCourses(categoryId) {
                try {
                    let response = await fetch(`http://api.cc.localhost/category/${categoryId}/courses`);
                    let courses = await response.json();
                    renderCourses(courses);
                } catch (error) {
                    console.error('Error fetching courses:', error);
                }
            }

            function renderCourses(courses) {
                let coursesContainer = document.getElementById('courses');
                coursesContainer.innerHTML = ''; // Clear previous courses

                courses.forEach(course => {
                    let courseElement = document.createElement('div');
                    courseElement.classList.add('course');
                    courseElement.innerHTML = `
                    <img src="${course.preview}" alt="${course.name}">
                    <div class="cnt">
                        <h4>${course.name}</h4>
                        <div class="description">${course.description}</div>
                    </div>
                `;
                    coursesContainer.appendChild(courseElement);
                    coursesContainer.appendChild(courseElement);
                    coursesContainer.appendChild(courseElement);
                    coursesContainer.appendChild(courseElement);
                });
            }

            fetchCategories();
        });
    </script>
</body>

</html>